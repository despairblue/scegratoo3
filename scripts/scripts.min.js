"use strict";angular.module("scegratooApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(function(e){e.when("/",{redirectTo:"/projects"}).when("/projects",{templateUrl:"views/projects.html",controller:"ProjectsCtrl"}).when("/projects/:project",{templateUrl:"views/project.html",controller:"ProjectCtrl"}).when("/projects/:project/x3d/:file*",{templateUrl:"views/projects/:project/x3d/:file.html",controller:"ProjectsProjectX3dFileCtrl"})});var bootstrap=function(){angular.element(document).ready(function(){angular.bootstrap(document,["scegratooApp"])})};window.__karma__?bootstrap():(traceur.options.experimental=!0,new traceur.WebPageTranscoder(document.location.href).run(function(){bootstrap()})),angular.module("scegratooApp").controller("MainCtrl",function(e,t){e.catalog=t}),angular.module("scegratooApp").controller("ProjectCtrl",function(e,t,a){e.project=a.get({project:t.project},function(a){e.projectName=t.project,a.files.forEach(function(e,t,a){a[t]={path:e,view:""}}),a.files.forEach(function(e){var t=e.path.match(/.[^.]*$/)[0];switch(t){case".js":e.view="source";break;case".x3d":e.view="x3d";break;case".sdf":e.view="ssiml"}})})}),angular.module("scegratooApp").controller("ProjectsCtrl",function(e,t){e.projects=t.query()}),angular.module("scegratooApp").directive("sgtNavigationBar",function(){return{templateUrl:"views/directives/sgt-navigation-bar.html",restrict:"AE",scope:!0,link:function(e,t){e.items=[{text:"X3D",href:"x3d"},{text:"Source",href:"source"},{text:"Tree",href:"tree"},{text:"Ssiml",href:"ssiml"}],t.addClass("navbar navbar-default navbar-fixed-top"),t.attr("role","navigation")}}}),angular.module("scegratooApp").directive("sgtX3d",function(e,t,a,n,r,o,l){return{restrict:"AE",link:function(t,a,i){var c=["templates/crosshair.html","templates/planeSensor-X.html","templates/planeSensor-Y.html"],u=[];angular.forEach(c,function(e){u.push(r.get(e,{cache:l}))}),o.all(u).then(function(e){angular.forEach(e,function(e){l.put(e.config.url,e.data)})}).then(function(){var r=new e.dat.GUI({autoPlace:!1});console.debug("Created ",r),a.parent().prepend($(r.domElement).css("float","left").css("position","absolute").css("z-index",1));var o=r.addFolder("Coordinates"),l=r.addFolder("Switches"),c=n.setUp(a);o.add(c,"x").listen(),o.add(c,"y").listen(),o.add(c,"z").listen(),l.add(c,"useHitPnt"),l.add(c,"snapToGrid"),t.$watch(i.content,function(e){a.html(e),a.children().addClass("fullpage"),c=n.setUp(a)})})}}}),angular.module("scegratooApp").value("catalog",[{id:1,name:"Batarang",img:"images/yeoman.png",price:80},{id:2,name:"Utility Belt",img:"images/yeoman.png",price:120}]),angular.module("scegratooApp").value("Constants",{apiRoot:"api/v1"}),angular.module("scegratooApp").service("Project",function(e,t,a){var n=a.apiRoot+"/projects/:project.:format",r=e(n,{format:"json"});return{get:function(t,n){if(t.file){var o=[a.apiRoot,"projects",encodeURI(t.project),encodeURI(t.file)].join("/"),l=e(o,{},{get:{method:"GET",transformResponse:function(e){return{data:e}}}});return l.get(n)}return r.get(t,n)},query:r.query}}),angular.module("scegratooApp").service("x3dQuery",function(){angular.element.fn.extend({color:function(e){var t=this.get(0);if(e)return angular.isArray(e)?(e=angular.copy(e),angular.forEach(t.getElementsByTagName("Material"),function(t){t.diffuseColor=e.shift()}),angular.forEach(t.getElementsByTagName("material"),function(t){t.diffuseColor=e.shift()})):(angular.forEach(t.getElementsByTagName("Material"),function(t){t.diffuseColor=e}),angular.forEach(t.getElementsByTagName("material"),function(t){t.diffuseColor=e})),this;var a=[];return angular.forEach(t.getElementsByTagName("Material"),function(e){a.push(e.diffuseColor)}),angular.forEach(t.getElementsByTagName("material"),function(e){a.push(e.diffuseColor)}),a},runtime:function e(){var t=this,a={},e=this.firstParent("x3d").get(0).runtime;return angular.forEach(Object.getPrototypeOf(e),function(n,r){a[r]=angular.bind(e,n,t.get(0))}),a},firstParent:function(e){for(var t,a=this.get(0);"#document"!==a.nodeName.toLowerCase();)if(a=a.parentNode,a.nodeName.toLowerCase()===e){t=a;break}return t?angular.element(t):angular.element()},lastParent:function(e){for(var t,a=this.get(0);"#document"!==a.nodeName.toLowerCase();)a=a.parentNode,a.nodeName.toLowerCase()===e&&(t=a);return t?angular.element(t):angular.element()}})}),angular.module("scegratooApp").service("X3dWidgets",function(){var e=function(){},t=function(){};return{createCrosshair:e,createPlane:t}}),angular.module("scegratooApp").service("X3domUtils",function(e,t,a,n){var r,o,l,i,c,u,s={x:0,y:0,z:0},d={useHitPnt:!1,snapToGrid:!1,x:"",y:"",z:""},g=function(t){var a="",n=angular.element(t.hitObject).lastParent("inline"),r=n.runtime().getBBox();u=angular.element('<Transform scale="'+r.max+'"><Shape><Appearance><Material diffuseColor="1 1 1" transparency="0.5"/></Appearance><Sphere /></Shape></Transform>'),d.useHitPnt?s=new e.x3dom.fields.SFVec3f(t.hitPnt[0],t.hitPnt[1],t.hitPnt[2]):(console.debug(document.getElementsByTagName("shape")[1]._x3domNode.getCenter()),s=n.get(0)._x3domNode.getVolume().center),n.get(0).parentNode.appendChild(o),a=s.x+" "+s.y+" "+s.z,o.setAttribute("translation",a),c=n.color(),n.color("yellow").before(u)},p=function(){},f=function(e){var t=angular.element(e.hitObject).lastParent("inline");o.parentNode&&o.parentNode.removeChild(o),u.remove(),t.color(c)},m=function(t){var a,n;"translation_changed"===t.fieldName&&(a=e.x3dom.fields.SFMatrix4f.parseRotation(t.target.getAttribute("axisRotation")),n=a.multMatrixVec(t.value),d.snapToGrid&&(n.x=Math.floor(n.x)),angular.forEach(r,function(e){var t=e.parentNode.getFieldValue("translation");t.x=n.x,e.parentNode.setFieldValue("translation",t)}))},h=function(t){var a,n;"translation_changed"===t.fieldName&&(a=e.x3dom.fields.SFMatrix4f.parseRotation(t.target.getAttribute("axisRotation")),n=a.multMatrixVec(t.value),d.snapToGrid&&(n.y=Math.floor(n.y)),angular.forEach(r,function(e){var t=e.parentNode.getFieldValue("translation");t.y=n.y,e.parentNode.setFieldValue("translation",t)}))},v=function(c){var u=0;return console.debug("Set up scene."),e.x3dom.debug.logException=function(e){console.error(e.stack)},o=angular.element(a.get("templates/crosshair.html")).get(0),l=angular.element(a.get("templates/planeSensor-X.html")).get(0),i=angular.element(a.get("templates/planeSensor-Y.html")).get(0),r=c.find("inline"),angular.forEach(r,function(e){var a=e.getAttribute("url");e.setAttribute("url",n.apiRoot+"/projects/"+t.project+"/"+t.file.replace(/\/[^\/]*$/,"")+"/"+a)}),e.x3dom.reload(),angular.forEach(c.find("scene"),function(e){e.appendChild(l),e.appendChild(i)}),angular.forEach(r,function(t){t.addEventListener("mousedown",g),t.addEventListener("mouseup",f),t.addEventListener("load",function(){u+=1,u===r.length&&c.children().get(0)&&c.children().get(0).runtime&&(window.x3dNode=c.children().get(0),c.children().get(0).runtime.showAll())}),new e.x3dom.Moveable(c.children().get(0),t.parentElement,p,0,"all")}),l.children[0].addEventListener("onoutputchange",m),i.children[0].addEventListener("onoutputchange",h),d};return{setUp:v}}),angular.module("scegratooApp").controller("ProjectsProjectX3dFileCtrl",function(e,t,a){a.get({project:t.project,file:t.file},function(t){e.x3d=t.data})});